document.addEventListener('DOMContentLoaded', function() {
 console.log('üöÄ Starting smart loading system with fixed progress...');
 const loadingScreen = document.getElementById('loading-screen');
 const progressBar = document.querySelector('.loading-progress-fill');
 const progressText = document.querySelector('.loading-percentage');
 const body = document.body;
 if (!loadingScreen || !progressBar || !progressText) {
 console.error('‚ùå Loading screen elements not found!');
 body.classList.remove('loading');
 return;
 }
 function hideLoadingScreen() {
 body.classList.remove('loading');
 setTimeout(() => {
 loadingScreen.style.display = 'none';
 }, 500);
 }
 class MediaLoadingTracker {
 constructor() {
 this.startTime = Date.now();
 this.loadingDuration = 2500; 
 this.progressInterval = null;
 this.currentProgress = 0;
 this.criticalContentReady = false;
 this.detectConnectionSpeed();
 this.initializeMediaTracking();
 }
 initializeMediaTracking() {
 this.startFixedProgressBar();
 setTimeout(() => {
 this.trackCriticalContent();
 }, 100);
 }
 startFixedProgressBar() {
 console.log('üöÄ Starting fixed progress bar (0-100% in 2.5s)');
 const updateInterval = 50; 
 const progressStep = (100 / this.loadingDuration) * updateInterval;
 this.progressInterval = setInterval(() => {
 this.currentProgress += progressStep;
 if (this.currentProgress >= 100) {
 this.currentProgress = 100;
 clearInterval(this.progressInterval);
 this.completeLoading();
 } else {
 this.updateProgressBar(this.currentProgress);
 }
 }, updateInterval);
 }
 updateProgressBar(progress) {
 progressBar.style.width = `${progress}%`;
 progressText.textContent = `${Math.floor(progress)}%`;
 }
 trackCriticalContent() {
 const images = document.querySelectorAll('img[src]');
 let criticalImages = [];
 images.forEach(img => {
 const src = img.src;
 if (src && (
 src.includes('69.webp') || 
 src.includes('telegram.webp') || 
 src.includes('youtube.webp') ||
 src.includes('twitch.webp') ||
 src.includes('okno.webp') || 
 src.includes('tournaments/') || 
 src.includes('tournament-cards/') 
 )) {
 criticalImages.push(img);
 }
 });
 console.log(`üìä Tracking ${criticalImages.length} critical images in background`);
 let loadedImages = 0;
 const totalImages = criticalImages.length;
 const checkAllLoaded = () => {
 loadedImages++;
 console.log(`‚úÖ Critical image loaded (${loadedImages}/${totalImages})`);
 if (loadedImages >= totalImages) {
 this.criticalContentReady = true;
 console.log('üéâ All critical content ready!');
 }
 };
 criticalImages.forEach(img => {
 if (img.complete && img.naturalWidth > 0) {
 checkAllLoaded();
 } else {
 img.addEventListener('load', checkAllLoaded);
 img.addEventListener('error', checkAllLoaded); 
 }
 });
 setTimeout(() => {
 if (!this.criticalContentReady) {
 this.criticalContentReady = true;
 console.log('‚è∞ Critical content marked as ready (timeout)');
 }
 }, 2000);
 }
 completeLoading() {
 progressBar.style.width = '100%';
 progressText.textContent = '100%';
 const elapsed = Date.now() - this.startTime;
 console.log(`üéâ Fixed progress complete! Total time: ${elapsed}ms`);
 console.log(`üìä Critical content ready: ${this.criticalContentReady}`);
 setTimeout(() => {
 hideLoadingScreen();
 this.startVideoLazyLoading();
 }, 300);
 }
 startVideoLazyLoading() {
 console.log('üé¨ Starting lazy loading of videos...');
 const videos = document.querySelectorAll('video');
 videos.forEach((video, index) => {
 const observer = new IntersectionObserver((entries) => {
 entries.forEach(entry => {
 if (entry.isIntersecting) {
 console.log(`üé¨ Video ${index + 1} is visible, starting load...`);
 if (video.readyState === 0) {
 video.preload = 'auto';
 video.load();
 }
 observer.unobserve(video);
 }
 });
 }, {
 rootMargin: '50px' 
 });
 observer.observe(video);
 });
 }
 detectConnectionSpeed() {
 const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
 if (connection) {
 const effectiveType = connection.effectiveType;
 console.log(`üì∂ Connection type: ${effectiveType}`);
 if (effectiveType === 'slow-2g' || effectiveType === '2g') {
 this.loadingDuration = 3500; 
 } else if (effectiveType === '3g') {
 this.loadingDuration = 2500; 
 } else {
 this.loadingDuration = 2000; 
 }
 console.log(`‚è±Ô∏è Adjusted loading duration: ${this.loadingDuration}ms`);
 }
 }
 }
 const mediaTracker = new MediaLoadingTracker();
});